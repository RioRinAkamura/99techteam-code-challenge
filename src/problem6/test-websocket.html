<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>WebSocket Scoreboard Test</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
        background-color: #f5f5f5;
      }
      .container {
        background: white;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        margin-bottom: 20px;
      }
      h1 {
        color: #333;
      }
      .status {
        padding: 10px;
        border-radius: 4px;
        margin: 10px 0;
        font-weight: bold;
      }
      .status.connected {
        background-color: #d4edda;
        color: #155724;
      }
      .status.disconnected {
        background-color: #f8d7da;
        color: #721c24;
      }
      button {
        background-color: #007bff;
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 4px;
        cursor: pointer;
        margin: 5px;
        font-size: 14px;
      }
      button:hover {
        background-color: #0056b3;
      }
      button:disabled {
        background-color: #ccc;
        cursor: not-allowed;
      }
      #scoreboard {
        margin-top: 20px;
      }
      .score-item {
        display: flex;
        justify-content: space-between;
        padding: 10px;
        margin: 5px 0;
        background-color: #f8f9fa;
        border-radius: 4px;
        border-left: 4px solid #007bff;
      }
      .score-item.rank-1 {
        border-left-color: #ffd700;
        background-color: #fff9e6;
      }
      .score-item.rank-2 {
        border-left-color: #c0c0c0;
        background-color: #f5f5f5;
      }
      .score-item.rank-3 {
        border-left-color: #cd7f32;
        background-color: #faf5f0;
      }
      #messages {
        max-height: 300px;
        overflow-y: auto;
        background-color: #f8f9fa;
        padding: 10px;
        border-radius: 4px;
        font-family: monospace;
        font-size: 12px;
      }
      .message {
        margin: 5px 0;
        padding: 5px;
        border-left: 3px solid #007bff;
        background-color: white;
      }
      .message.error {
        border-left-color: #dc3545;
      }
      .message.success {
        border-left-color: #28a745;
      }
      .timestamp {
        color: #666;
        font-size: 10px;
      }
    </style>
  </head>
  <body>
    <h1>üîå WebSocket Scoreboard Test Client</h1>

    <div class="container">
      <h2>Connection Status</h2>
      <div id="status" class="status disconnected">Disconnected</div>
      <button id="connectBtn" onclick="connect()">Connect</button>
      <button id="disconnectBtn" onclick="disconnect()" disabled>
        Disconnect
      </button>
      <button onclick="clearMessages()">Clear Messages</button>
    </div>

    <div class="container">
      <h2>üìä Live Scoreboard</h2>
      <div id="scoreboard">
        <p>Connect to WebSocket to see live updates...</p>
      </div>
    </div>

    <div class="container">
      <h2>üì® WebSocket Messages</h2>
      <div id="messages"></div>
    </div>

    <script>
      let ws = null;
      const statusEl = document.getElementById('status');
      const connectBtn = document.getElementById('connectBtn');
      const disconnectBtn = document.getElementById('disconnectBtn');
      const messagesEl = document.getElementById('messages');
      const scoreboardEl = document.getElementById('scoreboard');

      // Get WebSocket URL (adjust if your server is on a different port)
      const wsUrl = 'ws://localhost:3000/ws/scoreboard';

      function addMessage(message, type = 'info') {
        const messageEl = document.createElement('div');
        messageEl.className = `message ${type}`;
        const timestamp = new Date().toLocaleTimeString();
        messageEl.innerHTML = `
                <span class="timestamp">[${timestamp}]</span> ${message}
            `;
        messagesEl.appendChild(messageEl);
        messagesEl.scrollTop = messagesEl.scrollHeight;
      }

      function updateStatus(connected) {
        if (connected) {
          statusEl.textContent = '‚úÖ Connected';
          statusEl.className = 'status connected';
          connectBtn.disabled = true;
          disconnectBtn.disabled = false;
        } else {
          statusEl.textContent = '‚ùå Disconnected';
          statusEl.className = 'status disconnected';
          connectBtn.disabled = false;
          disconnectBtn.disabled = true;
        }
      }

      function updateScoreboard(scores) {
        if (!scores || scores.length === 0) {
          scoreboardEl.innerHTML = '<p>No scores available</p>';
          return;
        }

        let html = '<h3>Top 10 Players</h3>';
        scores.forEach((score) => {
          const rankClass = `rank-${score.rank}`;
          html += `
                    <div class="score-item ${rankClass}">
                        <div>
                            <strong>#${score.rank}</strong> ${score.username}
                        </div>
                        <div>
                            <strong>${score.score.toLocaleString()}</strong> points
                        </div>
                    </div>
                `;
        });
        scoreboardEl.innerHTML = html;
      }

      function connect() {
        if (ws && ws.readyState === WebSocket.OPEN) {
          addMessage('Already connected', 'info');
          return;
        }

        addMessage(`Connecting to ${wsUrl}...`, 'info');
        ws = new WebSocket(wsUrl);

        ws.onopen = () => {
          addMessage('‚úÖ WebSocket connection established!', 'success');
          updateStatus(true);
        };

        ws.onmessage = (event) => {
          try {
            const message = JSON.parse(event.data);
            addMessage(`üì® Received: ${message.type}`, 'success');

            if (
              message.type === 'scoreboard_update' ||
              message.type === 'connection_established'
            ) {
              if (message.data && message.data.scores) {
                updateScoreboard(message.data.scores);
                addMessage(
                  `Updated scoreboard with ${message.data.scores.length} players`,
                  'info'
                );
              }
            }

            console.log('WebSocket message:', message);
          } catch (error) {
            addMessage(`‚ùå Error parsing message: ${error.message}`, 'error');
            console.error('Message parse error:', error, event.data);
          }
        };

        ws.onerror = (error) => {
          addMessage(`‚ùå WebSocket error occurred`, 'error');
          console.error('WebSocket error:', error);
        };

        ws.onclose = (event) => {
          addMessage(
            `üîå Connection closed (code: ${event.code}, reason: ${
              event.reason || 'none'
            })`,
            'info'
          );
          updateStatus(false);
          ws = null;
        };
      }

      function disconnect() {
        if (ws) {
          ws.close();
          addMessage('Disconnecting...', 'info');
        }
      }

      function clearMessages() {
        messagesEl.innerHTML = '';
      }
    </script>
  </body>
</html>
